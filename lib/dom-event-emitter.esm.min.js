const VERSION="1.0.0",WEAK_RELATION_MAP=new WeakMap;export class DOMEventEmitter{constructor(){const a={};WEAK_RELATION_MAP.set(this,a),a._event_queue=[]}addListener(a,b){if("function"!=typeof b)throw new TypeError("Given listener should be a function");const{_event_queue:c}=WEAK_RELATION_MAP.get(this),d=a.toString(),e=c[d]=c[d]||[];return e.push(b),this}on(a,b){let c=`${a}`.trim();if(0<c.length){c=c.split(",");for(let d of c)this.addListener(d.trim(),b)}return this}once(a,b){let c=`${a}`.trim();return 0<c.length&&([a]=c.split(",")),this.addListener(a,__ONCE_WRAPPER(this,a,b))}removeListener(a,b){const{_event_queue:c}=WEAK_RELATION_MAP.get(this),d=a.toString(),e=c[d];if(e)for(let f;0<=(f=e.indexOf(b));)e.splice(f,1);return this}removeAllListeners(a){const b=WEAK_RELATION_MAP.get(this),c=a.toString();return delete b._event_queue[c],this}off(a,b){let c=`${a}`.trim();if(0===c.length)return this;if(c=c.split(","),1===arguments.length){for(let d of c)this.removeAllListeners(d.trim());return this}for(let d of c)this.removeListener(d.trim(),b);return this}dispatch(a,...b){const{_event_queue:c}=WEAK_RELATION_MAP.get(this),d=a.toString(),e=__UNIQUE_ID(),f=c[d];if(Array.isArray(f)){let g=!0;const h={};Object.defineProperties(h,{_id:{value:e,enumerable:!0},type:{value:d,enumerable:!0},timestamp:{value:Date.now(),enumerable:!0},stopPropagation:{value:()=>{g=!1},enumerable:!0}});for(let j of f)if(j.call(this,h,...b),!g)break}return this}async dispatchAwait(a,...b){const{_event_queue:c}=WEAK_RELATION_MAP.get(this),d=a.toString(),e=__UNIQUE_ID(),f=c[d];if(Array.isArray(f)){let g=!0;const h={};Object.defineProperties(h,{_id:{value:e,enumerable:!0},type:{value:d,enumerable:!0},timestamp:{value:Date.now(),enumerable:!0},stopPropagation:{value:()=>{g=!1},enumerable:!0}});for(let j of f)if(await j.call(this,h,...b),!g)break}return this}emit(a,...b){return this.dispatch(a,...b)}emitAwait(a,...b){return this.dispatchAwait(a,...b)}listeners(a){const{_event_queue:b}=WEAK_RELATION_MAP.get(this),c=a.toString();return(b[c]||[]).slice(0)}get events(){const{_event_queue:a}=WEAK_RELATION_MAP.get(this),b=[];for(let c in a)a.hasOwnProperty(c)&&(0===a[c].length||b.push(c));return b}set events(a){throw new TypeError("Cannot assign to read only property 'events' of <DOMEventEmitter>")}static get version(){return VERSION}static set version(a){throw new TypeError("Cannot assign to read only property 'version' of <DOMEventEmitter>")}}const UID_MAP="0123456789ABCDEFGHIJKLMNOPQRSTUV".split("");function __UNIQUE_ID(){const a=new Uint8Array(16);for(let c=0;16>c;c++)a[c]=0|256*Math.random();let b="";for(let d,c=0;3>c;c++)d=5*c,b+=UID_MAP[a[d]>>3],b+=UID_MAP[(7&a[d])<<2|a[d+1]>>6],b+=UID_MAP[(62&a[d+1])>>1],b+=UID_MAP[(1&a[d+1])<<4|a[d+2]>>4],b+=UID_MAP[(15&a[d+2])<<1|a[d+3]>>7],b+=UID_MAP[(124&a[d+3])>>2],b+=UID_MAP[(3&a[d+3])<<3|a[d+4]>>5],b+=UID_MAP[31&a[d+4]];return b+=UID_MAP[a[15]>>3],b+=UID_MAP[(7&a[16])<<2],b}function __ONCE_WRAPPER(a,b,c){if("function"!=typeof c)throw new TypeError("Given listener should be a function");const d=function(...e){const{_event_queue:f,_handle_promise:g}=WEAK_RELATION_MAP.get(this),h=b.toString(),j=f[h]=f[h]||[];let k=j.indexOf(d);return g?Promise.resolve(c.call(a,...e)).then(()=>{0<=k&&j.splice(k,1)}):(c.call(a,...e),void(0<=k&&j.splice(k,1)))};return d}
